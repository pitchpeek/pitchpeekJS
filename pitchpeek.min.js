/** Copyright 2015 Jonathan Damon
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  http://www.apache.org/licenses/LICENSE-2.0
 */
function pitchpeek(elementId,optionalArguments){function objectify(t){for(var o={},e=0;e<t.length;e++)o[t[e]]="";return o}function showMarkers(t,o){for(var e in o)o[e].marker.setMap(t.getPano()in objectify(o[e].show)?t:null)}function addViews(panorama,options,views,hotspots){for(var panoid in views){0==options.menuFirstId&&(panorama.setPano(panoid),panorama.setPov({heading:views[panoid].heading,pitch:views[panoid].pitch,zoom:views[panoid].zoom}));var centerControlDiv=document.createElement("div"),centerControl=new createMenuItem(centerControlDiv,panorama,options,views[panoid],hotspots);centerControlDiv.index=options.menuFirstId++,panorama.controls[eval("google.maps.ControlPosition."+options.menuPosition)].push(centerControlDiv)}}function addHotspots(t,o,e){for(var n in e){var i={path:o.hotspotSvgIcon,strokeColor:o.hotspotStrokeColor,fillColor:o.hotspotFillColor,fillOpacity:o.hotspotOpacity,rotation:o.hotspotRotation,anchor:new google.maps.Point(o.hotspotAnchorX,o.hotspotAnchorY),scale:o.hotspotScale},a=o.contentBefore+e[n].content+o.contentAfter,s=new google.maps.InfoWindow({content:a,maxWidth:o.infowindowMaxWidth}),r=new google.maps.LatLng(e[n].latitude,e[n].longitude),l=new google.maps.Marker({position:r,map:t,icon:i,draggable:o.hotspotDraggable,title:e[n].title});e[n].marker=l,google.maps.event.addListener(l,"click",function(o,e,n){return function(){n.setContent(e),n.open(t,o)}}(l,a,s))}}function createMenuItem(t,o,e,n){var i=document.createElement("div");i.style.backgroundColor=e.menuButtonBackgroundColor,i.style.border=e.menuButtonBorder,i.style.borderRadius=e.menuButtonBorderRadius,i.style.boxShadow=e.menuButtonBoxShadow,i.style.cursor=e.menuButtonCursor,i.style.margin=e.menuButtonMargin,i.style.minWidth=e.menuButtonMinWidth,i.style.opacity=e.menuButtonOpacity,i.style.textAlign=e.menuButtonTextAlign,i.title=e.menuButtonTitlePrepend+n.title+e.menuButtonTitleAppend,t.appendChild(i);var a=document.createElement("div");a.style.color=e.menuTextColor,a.style.fontFamily=e.menuTextFontFamily,a.style.fontSize=e.menuTextFontSize,a.style.lineHeight=e.menuTextLineHeight,a.style.paddingLeft=e.menuTextPaddingLeft,a.style.paddingRight=e.menuTextPaddingRight,a.innerHTML=n.title,i.appendChild(a),google.maps.event.addDomListener(i,"click",function(){o.setPano(n.panoid),o.setPov({heading:n.heading,pitch:n.pitch,zoom:n.zoom})})}function stopRotation(t){return function(){clearInterval(t)}}function startRotation(t,o){var e=t.getPov();t.setPov({heading:e.heading+o,pitch:e.pitch,zoom:e.zoom})}if(this.options={initTour:!0,renderMode:"webgl",initialPano:"dwFEQYodwY0AAAQXL2YgRA",disableDefaultUI:!1,addressControl:!1,zoomControl:!1,clickToGo:!1,linksControl:!0,panControl:!1,enableCloseButton:!1,visible:!0,xml:null,rotatingStart:!1,rotatingStopOnHover:!0,rotatingFramerate:33,rotatingSpeed:.1,contentBefore:'<div id="content">',contentAfter:"</div>",menuFirstId:0,menuPosition:"LEFT_TOP",menuButtonBackgroundColor:"#fff",menuButtonBorder:"2px solid #fff",menuButtonBorderRadius:"3px",menuButtonBoxShadow:"0 2px 6px rgba(0,0,0,.3)",menuButtonCursor:"pointer",menuButtonMargin:"3px",menuButtonMinWidth:"100px",menuButtonOpacity:.9,menuButtonTextAlign:"center",menuButtonTitlePrepend:"Click to go to ",menuButtonTitleAppend:".",menuTextColor:"rgb(25,25,25)",menuTextFontFamily:"Roboto,Arial,sans-serif",menuTextFontSize:"16px",menuTextLineHeight:"38px",menuTextPaddingLeft:"5px",menuTextPaddingRight:"5px",infowindowMaxWidth:null,hotspotDraggable:!1,hotspotStrokeColor:"#000",hotspotFillColor:"#0266C8",hotspotOpacity:.9,hotspotRotation:0,hotspotScale:2,hotspotAnchorX:0,hotspotAnchorY:0,hotspotSvgIcon:"M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466z M14.757,8h2.42v2.574h-2.42V8z M18.762,23.622H16.1c-1.034,0-1.475-0.44-1.475-1.496v-6.865c0-0.33-0.176-0.484-0.484-0.484h-0.88V12.4h2.662c1.035,0,1.474,0.462,1.474,1.496v6.887c0,0.309,0.176,0.484,0.484,0.484h0.88V23.622z"},this.element=document.getElementById(elementId),"undefined"!=typeof optionalArguments)for(var key in this.options)optionalArguments.hasOwnProperty(key)&&(this.options[key]=optionalArguments[key]);this.setView=function(t){var o=void 0===t.panoid?this.panorama.getPano():t.panoid,e=void 0===t.heading?this.panorama.getPov().heading:t.heading,n=void 0===t.pitch?this.panorama.getPov().pitch:t.pitch,i=void 0===t.zoom?this.panorama.getPov().zoom:t.zoom;this.panorama.setPano(o),this.panorama.setPov({heading:e,pitch:n,zoom:i})},this.loadXMLDoc=function(t,o){var e,n,i;e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){n=e.responseXML.documentElement.getElementsByTagName("VIEW");for(var a={},s=0;s<n.length;s++){var r=n[s].getElementsByTagName("PANOID")[0].firstChild.nodeValue,l=n[s].getElementsByTagName("TITLE")[0].firstChild.nodeValue,p=parseFloat(n[s].getElementsByTagName("HEADING")[0].firstChild.nodeValue),d=parseFloat(n[s].getElementsByTagName("PITCH")[0].firstChild.nodeValue),m=parseFloat(n[s].getElementsByTagName("ZOOM")[0].firstChild.nodeValue);a[r]={panoid:r,title:l,heading:p,pitch:d,zoom:m}}i=e.responseXML.documentElement.getElementsByTagName("HOTSPOT");var u={};for(s=0;s<i.length;s++){for(var l=i[s].getElementsByTagName("TITLE")[0].firstChild.nodeValue,h=i[s].getElementsByTagName("CONTENT")[0].firstChild.nodeValue,g=parseFloat(i[s].getElementsByTagName("LATITUDE")[0].firstChild.nodeValue),c=parseFloat(i[s].getElementsByTagName("LONGITUDE")[0].firstChild.nodeValue),f=i[s].getElementsByTagName("PANO"),v=[],C=0;C<f.length;C++)v.push(f[C].firstChild.nodeValue);u[s]={title:l,content:h,latitude:g,longitude:c,show:v}}addViews(o,t,a,u),addHotspots(o,t,u),showMarkers(o,u),google.maps.event.addListener(o,"pano_changed",function(){showMarkers(o,u)})}},e.open("GET",t.xml,!0),e.send()},this.tour=function(){var t={pano:this.options.initialPano,mode:this.options.renderMode,disableDefaultUI:this.options.disableDefaultUI,addressControl:this.options.addressControl,zoomControl:this.options.zoomControl,clickToGo:this.options.clickToGo,linksControl:this.options.linksControl,panControl:this.options.panControl,enableCloseButton:this.options.enableCloseButton,visible:this.options.visible};if(this.panorama=new google.maps.StreetViewPanorama(this.element,t),this.options.xml&&this.loadXMLDoc(this.options,this.panorama,this.tourHotspots),this.options.rotatingStart){var o=setInterval(startRotation,this.options.rotatingFramerate,this.panorama,this.options.rotatingSpeed);this.options.rotatingStopOnHover&&(this.element.onmouseover=stopRotation(o))}},this.options.initTour&&this.tour()}